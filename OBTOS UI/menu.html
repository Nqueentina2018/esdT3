<!DOCTYPE html>
<html>
    <head>
        <title>The Ultimate Bubble Tea | Store</title>
        <meta name="description" content="This is the description">
        <link rel="stylesheet" href="../include/styles.css" />
        <script src="store.js" async></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>

        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>

        <script>
            function myFunction(value) {
                document.getElementById("demo").innerHTML = value;
            }
        </script>
    </head>

    <body>

        <header class="main-header">
            <nav class="main-nav nav">
                <ul>
                    <li><a href="menu.html">MENU</a></li>
                    <li><a href="locations.html">STORE OUTLETS</a></li>
                    <li><a href="wallet.html">WALLET</a></li>
                    <li><a href="notifications.php">NOTIFICATIONS</a></li>
                </ul>
            </nav>
            <h1 class="store-name store-name-large">The Ultimate Bubble Tea Store</h1>
        </header>
        <section class="container content-section">
            <div id="main-container" class="container">

                <form id='payment' action='orderdetails.html' method ="POST">
                    <table>
                    <tr>
                    <td colspan="4"><h3> Step 1: Select your Tea</h3></td>
                    </tr>
                    <tr>
                    
                    <td colspan="3"><STRONG> Tea Type</STRONG></td>
                    <td><STRONG>Price</STRONG></td>
            
                    </tr>
                    <tr>
                        
                        <td colspan="3" width="80%">
                            <input type='radio' name='drinks' value='Ah Kong Original Milk Tea' id='Ah Kong Original Milk Tea'>
                            <label for='Ah Kong Original Milk Tea'>Milk Tea</label></td>
                        <td width="22%">$3.50</td>
                        
                    </tr>
                    <tr>
                        
                        <td colspan="3">
                            <input type='radio' name='drinks' value='Brown Sugar Green Tea Macchiato' id='Brown Sugar Green Tea Macchiato'>
                            <label for='Brown Sugar Green Tea Macchiato'>Passion Fruit Yakult</label></td>
                        <td>$3.80</td>
                        
                    </tr>
                    <tr>
                        
                        <td colspan="3">
                            <input type='radio' name='drinks' value='Earl Grey Milk Tea' id='Earl Grey Milk Tea'>
                            <label for='Earl Grey Milk Tea'>Earl Grey Milk Tea</label></td>
                        <td>$3.00</td>
                    
                    </tr>
                    <tr>
                        
                        <td colspan="3">
                            <input type='radio' name='drinks' value='Rainbow Milk Tea' id='Rainbow Milk Tea'>
                            <label for='Rainbow Milk Tea'>Ginger Milk Tea</label></td>
                        <td>$4.00</td>
                        
                    </tr>
                    <tr>
                    <td colspan="4"><h3>Step 2: Select Your Topping (Optional) </h3> <small>(Each Topping + additional 50ct)</small></td>
                    </tr>
                    <tr>
                        <td width="25%"><input type='checkbox' name='toppings[]' value='Pearl' id='Pearl'><label for='Pearl'>Pearl</label></td>
                        <td width="25%"><input type='checkbox' name='toppings[]' value='Herbal Jelly' id='Herbal Jelly'><label for='Herbal Jelly'>Jelly</label></td>
                        <td width="25%"><input type='checkbox' name='toppings[]' value='Nata de Coco' id='Nata de Coco'><label for='Nata de Coco'>	
                        Rainbow Jelly</label></td>
                        <td width="25%"><input type='checkbox' name='toppings[]' value='Aloe Vera'id='Aloe Vera'><label for='Aloe Vera'>Aloe Vera</label></td>
            
                    </tr>
                   
                    </table>
                    <br>
            
                    <input type="reset" name="Reset">
                    <input name='totalAmt' type='hidden' id='totalAmt' value = 3.5>
                    <input name='cid' type='hidden' id='cid' value = 1>
                    <input type='submit' value='Purchase'>
                </form>
            <!-- <table>
                <tr>
                <th><h2 class="section-header">Drinks</h2></th>
                <th><h2 class="section-header">TOPPINGS</h2></th>
                </tr>

                <tr>
                <td>
                    <table id="drinksTable" class='table table-striped' border='1'>
                    <thead class='thead-dark'>
                        <tr>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Add</th>
                        </tr>
                    </thead>
                    </table>
                </td>
                
                <td>
                    <table id="toppingsTable" class='table table-striped' border='1'>
                    <thead class='thead-dark'>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Add</th>
                    </tr>
                    </thead>
                    </table>
                </td></tr>
            
            </table> -->
        
            
            <!-- <table id='cart'>
                <thead class='thead-dark'>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                </tr>
                </thead>
            </table> -->
            
            <button onclick="myFunction('drink1')">Add Me</button>

            <p id="demo"></p> -->

            <!-- <form id='payment' action='orderdetails.html' method ="POST">
            <input name='totalAmt' type='hidden' id='totalAmt' value = 5>
            <input name='cid' type='hidden' id='cid' value = 1>
            <input type='submit' value='Purchase'>
            </form> -->
        </section></div>

        <script>
            // Helper function to display error message
            function showError(message) {
                // Hide the table and button in the event of error
                $('#drinksTable').hide();
                
    
                // Display an error under the main container
                $('#main-container')
                    .append("<label>" + message + "</label>");
            }
    
            // getting drinks
            $(async () => {
                // Change serviceURL to your own
                
                var serviceURL = "http://127.0.0.1:5001/menu/drink";
    
                try {
                    const response =
                        await fetch(
                            serviceURL, { method: 'GET' }
                        );
                    const data = await response.json();
                    var drinks = data.menu; //the arr is in data.books of the JSON data
    
                    // array or array.length are falsy
                    if (!drinks || !drinks.length) {
                        showError('drinks list empty or undefined.')

                    } else {
                        // for loop to setup all table rows with obtained book data
                        var rows = "";
                        for (const drink of drinks) {
                            eachRow =
                                "<td>" + drink.name  + "</td>" +
                                "<td> $" + drink.price + "</td>"+
                                "<td><button class='btn btn-primary shop-item-button' type='button'>ADD TO CART</button></td>";
                            rows += "<tbody><tr>" + eachRow + "</tr></tbody>";
                        }
                        // add all the rows to the table
                        $('#drinksTable').append(rows);
                    }
                } catch (error) {
                    // Errors when calling the service; such as network error, 
                    // service offline, etc
                    showError
                        ('There is a problem retrieving drinks data, please try again later.<br />' + error);
    
                } // error
            });

            // getting toppings
            $(async () => {
                // Change serviceURL to your own
                
                var serviceURL = "http://127.0.0.1:5001/menu/topping";
    
                try {
                    const response =
                        await fetch(
                            serviceURL, { method: 'GET' }
                        );
                    const data = await response.json();
                    var toppings = data.menu; 
    
                    // array or array.length are falsy
                    if (!toppings || !toppings.length) {
                        showError('drinks list empty or undefined.')

                    } else {
                        // for loop to setup all table rows with obtained book data
                        var rows = "";
                        for (const topping of toppings) {
                            eachRow =
                                "<td>" + topping.name  + "</td>" +
                                "<td> $" + topping.price + "</td>"+
                                "<td><button class='btn btn-primary shop-item-button' type='button'>ADD TO CART</button></td>";
                            rows += "<tbody><tr>" + eachRow + "</tr></tbody>";
                        }
                        // add all the rows to the table
                        $('#toppingsTable').append(rows);
                    }
                } catch (error) {
                    // Errors when calling the service; such as network error, 
                    // service offline, etc
                    showError
                        ('There is a problem retrieving toppings data, please try again later.<br />' + error);
    
                } // error
            });

            

            $("#payment").submit(async (event) => {
            // event.preventDefault();
            var cid = $('#cid').val();
            var sid = $('#sid').val();
            var totalAmt = $('#totalAmt').val();
            var serviceURL = "http://127.0.0.1:5003/payment" ;
            // console.log(serviceURL);

            try {
                console.log(JSON.stringify({cid : cid ,totalAmt : totalAmt}))
                
                let response =
                    await fetch(
                        serviceURL,
                        {
                            method: 'POST',
                            headers: { "Content-Type": "application/json"  }, 
                            body: JSON.stringify({cid : cid , sid : sid ,totalAmt : totalAmt}),
                        });
                console.log(response)
                let data = await response.json();
                if (response.ok) {
                    console.log(data);
                    window.location.href = "orderdetails.html";
                }

            } catch (error) {
                // Errors when calling the service; such as network error, 
                // service offline, etc
                showError
                    ('There is a problem retrieving payment data, please try again later.<br />' + error);

            } // error
        });

        </script>
        
    </body>
</html>